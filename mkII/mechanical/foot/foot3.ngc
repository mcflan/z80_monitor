(cut chamfer on foot)

o100 sub
    ( Mill a rectangle with radiused corners, anti-clockwise.               )
    ( Starts bottom left of rectange, so ensure there is a clear path in.   )
    ( usage:                                                                )
    (   o100 call [x centre] [y centre] [x width] [ y width] [radius]       )
g91.1 (relative distance mode for G2/G3 centre values I,J,K)
#3=[#3/2]
#4=[#4/2]
g1 x[#1 - #3] y[#2 - #4]               (start bottom left corner beyond radius)
g1 x[#1 + #3 - #5]                          (cut bottom)
g3 x[#1 + #3] y[#2 - #4 + #5] i0 j[#5]      (bottom right corner)
g1 y[#2 + #4 - #5]                          (cut RHS)
g3 x[#1 + #3 - #5] y[#2 + #4] i[-#5] j0     (top right corner)
g1 x[#1 - #3 + #5]                          (cut top)
g3 x[#1 - #3] y[#2 + #4 - #5] i0 j[-#5]     (top left corner)
g1 y[#2 - #4 + #5]                          (cut LHS)
g3 x[#1 - #3 + #5] y[#2 - #4] i[#5] j0      (bottom right corner)
g1 x[#1 - #3 + #5 + #3/2 ] y[#2 - #4 - #4/2]       (move off)
o100 endsub

; *****************************************************************************
;   Main Code
; *****************************************************************************

; Preamble
G80 ; Cancel any canned cycle
G17 ; XY plane
G54 ; Coordinate System 1
G90 ; Absolute
G21 ; Millimetres
G40 ; Cancel cutter radius comp
G49 ; Cancel tool length comp

#<safe_Z> = 60
#<safe_Z_uncomp> = 100

T3 M6 (Load chamfer tool)
g43 (tool length offet on)
g0 z[#<safe_Z>] (safe Z)
g0 x-70 y-30 (home bottom left)

f150

; The chamfer cutter is set-up in the tool table with Z height and radius such
; that it should just touch the corner when tool offet and cutter compensation
; are applied. So to cut a chamfer of a certain depth, choose a path that
; amount closer into the workpiece. The length measured across the 45 degree
; chamfer will then be sqrt(2) times this amount. E.g. for 1mm chamfer, move
; in 0.71mm.

g0 z14
g42 (radius compensation on)
(cut 0.7 mm in from outline dims to give 1mm chamfer)
o100 call [0] [0] [80-1.41] [16-1.41] [5-0.71]
g0 z[#<safe_Z>] (safe Z)
g40 (length compensation off)
g0 x-70 y-30 (home bottom left)

g0 x-150 (move clear  of workpiece)

g49 (length compensation off)
g0 z[#<safe_Z_uncomp>]

m2
