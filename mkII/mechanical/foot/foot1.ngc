(Material - engineering plastic TBD)
(Stock must be less than 100mm in X dir)
( Set X0 Y0 to centre of material, Z0 to desired bottom of finished part and   )
( ensure this is at least 5mm above vise jaws. Ensure top of raw stock is no   )
( more than 40mm from bottom of finished part.                                 )
(Finished part height is 35mm)

o100 sub
    ( Mill a rectangle with radiused corners, anti-clockwise.               )
    ( Starts bottom left of rectange, so ensure there is a clear path in.   )
    ( usage:                                                                )
    (   o100 call [x centre] [y centre] [x width] [ y width] [radius]       )
g91.1 (relative distance mode for G2/G3 centre values I,J,K)
#3=[#3/2]
#4=[#4/2]
g1 x[#1 - #3] y[#2 - #4]               (start bottom left corner beyond radius)
g1 x[#1 + #3 - #5]                          (cut bottom)
g3 x[#1 + #3] y[#2 - #4 + #5] i0 j[#5]      (bottom right corner)
g1 y[#2 + #4 - #5]                          (cut RHS)
g3 x[#1 + #3 - #5] y[#2 + #4] i[-#5] j0     (top right corner)
g1 x[#1 - #3 + #5]                          (cut top)
g3 x[#1 - #3] y[#2 + #4 - #5] i0 j[-#5]     (top left corner)
g1 y[#2 - #4 + #5]                          (cut LHS)
g3 x[#1 - #3 + #5] y[#2 - #4] i[#5] j0      (bottom right corner)
g1 x[#1 - #3 + #5 + #3/2 ] y[#2 - #4 - #4/2]       (move off)
o100 endsub

o101 sub
    ( Mill a rectangle with sharp corners, anti-clockwise with manual cutter comp. )
    ( Starts bottom left of rectange, so ensure there is a clear path in.   )
    ( usage:                                                                )
    (   o100 call [x centre] [y centre] [x width] [ y width] [r_cutter]     )
#3=[#3/2]
#4=[#4/2]
g1 x[#1 - #3 - #5] y[#2 - #4 - #5]          (feed to start point bottom left)
g1 x[#1 + #3 + #5]                          (cut bottom)
g1 y[#2 + #4 + #5]                          (cut RHS)
g1 x[#1 - #3 - #5]                          (cut top)
g1 y[#2 - #4 - #5]                          (cut LHS)
o101 endsub

o102 sub
    ( mill an internal pocket with 3 passes in Y dir, i.e. y width must be < 3x cutter diam)
    (                 #1          #2       #3          #4       #5          #6      #7     #8         #9)
    (   o102 call [x centre] [y centre] [x width] [ y width] [r_cutter] [top_z] [z_steps] [bottom z] [z_safe])

#3 = [#3/2 - #5]
#4 = [#4/2 - #5]
#11 = [[#6 - #8] / #7] (step size)
#10 = [#6] (set to  start z )

g0 z[#9] (move to safe Z pos)
g0 x[#1 - #3] y[#2 - #4] (move over bottom left corner)

g0 z[#6] (rapid to top z)
o1021 do
f[#<_xy_feed>]
#10 = [#10 - #11/2] (decrement half a step)
g1 z[#10] f[#<_z_feed>]   (feed down to next z)
f[#<_xy_feed>]
g1 x[#1 + #3]   (feed to bottom right)
g1 y[#2 + #4]   (feed to top right)
g1 x[#1 - #3]   (feed to top left)
g1 y[#2]        (feed to middle left)
g1 x[#1 + #3]   (feed to middle right)
#10 = [#10 - #11/2] (decrement half a step)
g1 z[#10] f[#<_z_feed>]   (feed down)
f[#<_xy_feed>]
g1 y[#2 + #4]   (feed to top right)
g1 x[#1 - #3]   (feed to top left)
g1 y[#2 - #4]   (feed to bottom left)
g1 x[#1 + #3]   (feed to bottom right)
g1 y[#2]        (feed to middle right)
g1 x[#1 - #3]   (feed to middle left)
g1 y[#2 - #4]   (feed to bottom left)
o1021 while [#10 GT #8]

g0 z[#9] (move to safe Z pos)
o102 endsub

; *****************************************************************************
;   Main Code
; *****************************************************************************

; Preamble
G80 ; Cancel any canned cycle
G17 ; XY plane
G54 ; Coordinate System 1
G90 ; Absolute
G21 ; Millimetres
G40 ; Cancel cutter radius comp
G49 ; Cancel tool length comp

#<safe_Z> = 60
#<safe_Z_uncomp> = 100
#<safe_X> = -70
#<safe_Y> = -25
#<r_cutter>=5
#<_z_feed>=50
#<_xy_feed>=300

T1 M6 (Load tool 1)
g43 (tool length offet on)
g0 z[#<safe_Z>]
g0 x[#<safe_X>] y[#<safe_Y>]

f[#<_xy_feed>]
g0 z[#<safe_Z>]
g40 (compensation off)
g0 x[#<safe_X>] y[#<safe_Y>]


( Mill top flat)
f[#<_xy_feed>]
o102 call [0] [0] [100] [24] [#<r_cutter>] [36] [1] [35] [40]

(Mill down to top of step, leave 0.2 on ends of boss for finishing cut)
o102 call [-[50+15.2]/2] [0] [50-15.2] [24] [#<r_cutter>] [35] [2] [23] [40]
o102 call [[50+15.2]/2] [0] [50-15.2] [24] [#<r_cutter>] [35] [2] [23] [40]

(Mill down to top of radius)
o102 call [-[50+17.2]/2] [0] [50-17.2] [24] [#<r_cutter>] [23] [1] [17] [40]
o102 call [[50+17.2]/2] [0] [50-17.2] [24] [#<r_cutter>] [23] [1] [17] [40]

(Mill down to top of foot)
o102 call [-[50+20.2]/2] [0] [50-20.2] [24] [#<r_cutter>] [17] [1] [14] [40]
o102 call [[50+20.2]/2] [0] [50-20.2] [24] [#<r_cutter>] [17] [1] [14] [40]

g0 z[#<safe_Z>]
g0 x[#<safe_X>] y[#<safe_Y>]

f[#<_xy_feed>]
g0 z29
( remove remaining material around centre boss )
o101 call [0] [0] [30.2] [10.4] [#<r_cutter>]
g1 z26 f[#<_z_feed>]
f[#<_xy_feed>]
o101 call [0] [0] [30.2] [10.4] [#<r_cutter>]
g1 z23 f[#<_z_feed>]
f[#<_xy_feed>]
o101 call [0] [0] [30.2] [10.4] [#<r_cutter>]
o101 call [0] [0] [30.0] [10.2] [#<r_cutter>]

g0 z[#<safe_Z>]
g0 x[#<safe_X>] y[#<safe_Y>]

g0 z20
( remove remaining material to top of radius )
o101 call [0] [0] [34.2] [10.2] [#<r_cutter>]
g1 z17 f[#<_z_feed>]
f[#<_xy_feed>]
f[#<_xy_feed>]
o101 call [0] [0] [34.0] [10.0] [#<r_cutter>]

g0 z[#<safe_Z>]
g0 x[#<safe_X>] y[#<safe_Y>]

g0 z14
( remove remaining material to top of foot )
o101 call [0] [0] [40.2] [16.4] [#<r_cutter>]
o101 call [0] [0] [40.0] [16.2] [#<r_cutter>]

g0 z[#<safe_Z>]
g0 x[#<safe_X>] y[#<safe_Y>]

g0 z10
( remove bulk of  material around foot )
o101 call [0] [0] [80.8] [16.8] [#<r_cutter>]
g1 z6 f[#<_z_feed>]
f[#<_xy_feed>]
o101 call [0] [0] [80.8] [16.8] [#<r_cutter>]
g1 z1 f[#<_z_feed>]
f[#<_xy_feed>]
o101 call [0] [0] [80.8] [16.8] [#<r_cutter>]
g1 z-3 f[#<_z_feed>]
f[#<_xy_feed>]
o101 call [0] [0] [80.8] [16.8] [#<r_cutter>]

g0 z[#<safe_Z>]
g0 x[#<safe_X>] y[#<safe_Y>]

(final outline of foot with radiused corners)
g0 z-3
g42 (compensation on)
o100 call [0] [0] [80.8] [16.8] [5]
g0 z[#<safe_Z>]
g40 (compensation off)
g0 x[#<safe_X>] y[#<safe_Y>]

g0 z-3
g42 (compensation on)
o100 call [0] [0] [80.0] [16.0] [5]
g0 z[#<safe_Z>]
g40 (compensation off)
g0 x[#<safe_X>] y[#<safe_Y>]

g0 x-150 (move clear  of workpiece)

g49 (length compensation off)
g0 z[#<safe_Z_uncomp>]

m2
